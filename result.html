<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Results</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>

<body>

    <nav>
        <a href="index.html" style="text-decoration: none;">
            <div class="logo">‚ú® AI Resume Critiquer</div>
        </a>
        <div style="display: flex; gap: 10px;">
            <button class="btn-nav btn-secondary" onclick="toggleTheme()">üåó Theme</button>
            <a href="upload.html" class="btn-nav">Upload New</a>
        </div>
    </nav>

    <div class="main-wrapper">
        <div class="sidebar">
            <div class="history-card">
                <h3 style="margin-bottom: 20px; color: var(--primary); display: flex; align-items: center; gap: 8px;">
                    <span>‚è±Ô∏è</span> Recent Scans
                </h3>
                <div id="historyList">
                    <p style="color:var(--text-muted); font-size: 0.95rem; text-align: center; padding: 2rem 0;">No
                        history yet.</p>
                </div>
            </div>
        </div>

        <div class="content">
            <div
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                <h1 style="margin: 0;">Analysis for <span id="candidateName" style="color: var(--primary);">...</span>
                </h1>

                <div style="display: flex; gap: 10px;">
                    <button onclick="downloadPDF()" class="btn-nav" style="background: var(--primary);">
                        üì• Download PDF
                    </button>
                    <button onclick="toggleDebug()" class="btn-nav btn-secondary">
                        üëÅÔ∏è View Raw Text
                    </button>
                </div>
            </div>

            <div class="card score-container">
                <h2 style="margin-bottom: 2rem; color: var(--text-main);">Overall ATS Match Score</h2>
                <div class="score-flex">
                    <!-- Circular CSS representation of score handled in JS if we want, but for simplicity let's use the UI with a large bold number -->
                    <div class="circular-score" id="circularScore" style="--score: 0;">
                        <span class="score-val-inner" id="scoreVal">0</span>
                    </div>
                    <p style="margin-top: 1rem; font-weight: 500; font-size: 1.1rem; color: var(--text-muted);">Out of
                        100</p>
                </div>
            </div>

            <div class="card result-section">
                <h3><span style="font-size: 1.5rem;">üìù</span> Professional Summary</h3>
                <p id="summaryText" style="font-size: 1.1rem; line-height: 1.7; color: var(--text-main);">Loading...</p>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;" class="grid-2">
                <div class="card result-section" style="margin-top:0;">
                    <h3 style="color: var(--success);"><span style="font-size: 1.4rem;">‚úÖ</span> Key Strengths</h3>
                    <div id="strengthsList" class="badge-container"></div>
                </div>
                <div class="card result-section" style="margin-top:0;">
                    <h3 style="color: var(--danger);"><span style="font-size: 1.4rem;">‚ö†Ô∏è</span> Critical Gaps</h3>
                    <div id="weaknessesList" class="badge-container"></div>
                </div>
            </div>

            <div class="card result-section">
                <h3 style="margin-bottom: 1.5rem;"><span style="font-size: 1.5rem;">üí°</span> Suggested Rewrites &
                    Advice</h3>
                <div id="improvementsList"></div>
            </div>
        </div>
    </div>

    <div id="debugModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="toggleDebug()">&times;</span>
            <h3 style="color: var(--primary); margin-bottom: 10px;">üîç Raw Extracted Text (OCR Output)</h3>
            <p style="font-size: 0.95rem; color: var(--text-muted);">This is exactly what the AI read from your file. If
                this looks like gibberish, the scan failed.</p>
            <pre id="rawTextContent">Loading...</pre>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Extend the existing script.js to update the circular score var
        const observer = new MutationObserver(() => {
            const scoreVal = document.getElementById("scoreVal");
            const circular = document.getElementById("circularScore");
            if (scoreVal && circular) {
                let s = parseInt(scoreVal.innerText) || 0;
                circular.style.setProperty('--score', s);

                // Adjust color dynamically based on score
                if (s >= 80) circular.style.background = `conic-gradient(var(--success) calc(${s} * 1%), var(--surface-border) 0)`;
                else if (s >= 50) circular.style.background = `conic-gradient(var(--warning) calc(${s} * 1%), var(--surface-border) 0)`;
                else circular.style.background = `conic-gradient(var(--danger) calc(${s} * 1%), var(--surface-border) 0)`;

                if (s >= 80) scoreVal.style.color = 'var(--success)';
                else if (s >= 50) scoreVal.style.color = 'var(--warning)';
                else scoreVal.style.color = 'var(--danger)';
            }
        });

        window.addEventListener('load', () => {
            const scoreVal = document.getElementById("scoreVal");
            if (scoreVal) {
                observer.observe(scoreVal, { childList: true, characterData: true, subtree: true });
                // Initial trigger
                setTimeout(() => {
                    let s = parseInt(scoreVal.innerText) || 0;
                    document.getElementById("circularScore").style.setProperty('--score', s);
                }, 500);
            }
        });
    </script>
</body>

</html>